<!DOCTYPE html>
<html>
<head>
  <title>DragonLi Web Interface</title>
</head>
<body>
  <h1>DragonLi</h1>
  <p>A word equation solver</p>

  <form onsubmit="return sendForm(event)">
    <label for="userInput">Enter a word equation problem:</label><br /><br />
    <textarea
      id="userInput"
      name="userInput"
      rows="30"
      cols="140"
    ></textarea>
    <br /><br />
    <button type="submit">Submit</button>
  </form>

  <!-- The solver's output or status messages go here -->
  <div id="solverOutput"
       style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;">
    <!-- Will be filled in by JavaScript -->
  </div>

  <script>
    // 1. On page load, fetch the file contents from /load-eq
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/load-eq');
        if (!response.ok) {
          throw new Error('Error fetching EQ file');
        }
        const fileContents = await response.text();
        document.getElementById('userInput').value = fileContents;
      } catch (error) {
        console.error('Could not load file:', error);
      }
    });

    // 2. On submit, POST the userâ€™s text to /process, run solver, and get answer
    async function sendForm(event) {
      event.preventDefault();
      const solverOutputDiv = document.getElementById('solverOutput');

      // Immediately show "processing..." so user knows something is happening
      solverOutputDiv.textContent = 'Processing...';

      const input = document.getElementById('userInput').value;

      try {
        const response = await fetch('/process', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userInput: input })
        });

        // Parse JSON response
        const result = await response.json();
        if (response.ok) {
          // If everything went well, show the solver output
          solverOutputDiv.textContent = result.solverOutput;
        } else {
          // If the server returned an error, show that message
          solverOutputDiv.textContent =
            'Solver Error: ' + (result.message || 'Unknown error');
        }
      } catch (error) {
        console.error('Network or server error:', error);
        solverOutputDiv.textContent =
          'An error occurred. Check the console for details.';
      }
      return false;
    }
  </script>
</body>
</html>
